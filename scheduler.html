<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="万鹤书院在线课程安排系统，方便学生查询课程时间表、预约课程、管理学习进度。" name="description"/><meta content="课程安排,排课系统,时间表,万鹤书院,在线工具" name="keywords"/><meta content="万鹤书院 Vanhok Academy" name="author"/><meta content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" name="robots"/><link href="https://page.vanhok.com/scheduler.html" rel="canonical"/><meta content="website" property="og:type"/><meta content="https://page.vanhok.com/scheduler.html" property="og:url"/><meta content="课程安排系统 | 排课工具 | 万鹤书院" property="og:title"/><meta content="万鹤书院在线课程安排系统，方便学生查询课程时间表、预约课程、管理学习进度。" property="og:description"/><meta content="万鹤书院 Vanhok Academy" property="og:site_name"/><meta content="zh_HK" property="og:locale"/><meta content="summary_large_image" name="twitter:card"/><meta content="https://page.vanhok.com/scheduler.html" name="twitter:url"/><meta content="课程安排系统 | 排课工具 | 万鹤书院" name="twitter:title"/><meta content="万鹤书院在线课程安排系统，方便学生查询课程时间表、预约课程、管理学习进度。" name="twitter:description"/><meta content="zh-CN" name="language"/><meta content="7 days" name="revisit-after"/><meta content="global" name="distribution"/><meta content="general" name="rating"/>
<title>课程安排系统 | 排课工具 | 万鹤书院</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet"/>
<style>
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .time-slot { min-height: 40px; }
        .lunch-dinner-break { background-color: #f3f4f6; min-height: 30px; }
        .subject-color-chinese { background-color: #fecaca; }
        .subject-color-english { background-color: #ddd6fe; }
        .subject-color-math { background-color: #bbf7d0; }
        .subject-color-physics { background-color: #fed7aa; }
        .subject-color-chemistry { background-color: #f0abfc; }
        .subject-color-biology { background-color: #a7f3d0; }
        .subject-color-economics { background-color: #fde68a; }
        .subject-color-history { background-color: #f8b4ff; }
        .subject-color-m2 { background-color: #c7d2fe; }
        .constraint-time-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 2px;
        }
        .time-button {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 12px;
        }
        .time-button.available { background-color: #dcfce7; border-color: #16a34a; }
        .time-button.unavailable { background-color: #fecaca; border-color: #dc2626; }
        .time-button.preferred { background-color: #dbeafe; border-color: #2563eb; }
    </style>
</head>
<body class="bg-gray-50">
<div class="container mx-auto px-4 py-6">
<!-- Header -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
<div class="text-center">
<h1 class="text-3xl font-bold text-blue-800 mb-2">万鹤书院HKDSE智能排课系统</h1>
<p class="text-gray-600">专业的HKDSE课程智能排课解决方案</p>
</div>
</div>
<!-- Navigation Tabs -->
<div class="bg-white rounded-lg shadow-md mb-6">
<div class="border-b border-gray-200">
<nav aria-label="Tabs" class="flex space-x-8">
<button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-blue-500 text-blue-600" id="courses-tab" onclick="showTab('courses')">
<i class="fas fa-book mr-2"></i>课程设置
                    </button>
<button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" id="teachers-tab" onclick="showTab('teachers')">
<i class="fas fa-chalkboard-teacher mr-2"></i>教师管理
                    </button>
<button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" id="constraints-tab" onclick="showTab('constraints')">
<i class="fas fa-cogs mr-2"></i>约束条件
                    </button>
<button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" id="schedule-tab" onclick="showTab('schedule')">
<i class="fas fa-calendar-alt mr-2"></i>智能排课
                    </button>
<button class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" id="results-tab" onclick="showTab('results')">
<i class="fas fa-table mr-2"></i>课表展示
                    </button>
</nav>
</div>
</div>
<!-- Course Settings Tab -->
<div class="tab-content active" id="courses">
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-2xl font-bold mb-6 text-gray-800">
<i class="fas fa-book text-blue-600 mr-2"></i>HKDSE课程设置
                </h2>
<!-- Required Subjects -->
<div class="mb-8">
<h3 class="text-xl font-semibold mb-4 text-gray-700">必修科目</h3>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<!-- Chinese -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">中文</h4>
<label class="flex items-center">
<input class="mr-2" id="chinese-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周总课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="chinese-hours" max="20" min="1" type="number" value="6"/>
</div>
</div>
</div>
<!-- Mathematics -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">数学</h4>
<label class="flex items-center">
<input class="mr-2" id="math-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周总课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="math-hours" max="20" min="1" type="number" value="6"/>
</div>
</div>
</div>
<!-- English (Detailed) -->
<div class="border border-gray-200 rounded-lg p-4 lg:col-span-2">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">英文（细分板块）</h4>
<label class="flex items-center">
<input class="mr-2" id="english-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="grid grid-cols-2 lg:grid-cols-5 gap-4">
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">英文听力A</label>
<input class="w-full px-2 py-1 border border-gray-300 rounded text-center" id="english-listening-a" max="10" min="0" type="number" value="2"/>
</div>
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">英文听力B</label>
<input class="w-full px-2 py-1 border border-gray-300 rounded text-center" id="english-listening-b" max="10" min="0" type="number" value="2"/>
</div>
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">英文阅读</label>
<input class="w-full px-2 py-1 border border-gray-300 rounded text-center" id="english-reading" max="10" min="0" type="number" value="2"/>
</div>
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">英文写作</label>
<input class="w-full px-2 py-1 border border-gray-300 rounded text-center" id="english-writing" max="10" min="0" type="number" value="2"/>
</div>
<div class="space-y-2">
<label class="block text-sm font-medium text-gray-700">英文口语</label>
<input class="w-full px-2 py-1 border border-gray-300 rounded text-center" id="english-speaking" max="10" min="0" type="number" value="2"/>
</div>
</div>
<div class="mt-3 p-2 bg-blue-50 rounded">
<span class="text-sm text-blue-800">英文总课时：<span id="english-total">10</span> 课时/周</span>
</div>
</div>
</div>
</div>
<!-- Elective Subjects -->
<div class="mb-8">
<h3 class="text-xl font-semibold mb-4 text-gray-700">选修科目</h3>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<!-- Physics -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">物理</h4>
<label class="flex items-center">
<input class="mr-2" id="physics-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="physics-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合1：物理 &amp; 历史</div>
</div>
</div>
<!-- Chemistry -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">化学</h4>
<label class="flex items-center">
<input class="mr-2" id="chemistry-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="chemistry-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合2：化学 &amp; 经济</div>
</div>
</div>
<!-- Biology -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">生物</h4>
<label class="flex items-center">
<input class="mr-2" id="biology-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="biology-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合3：生物 &amp; M2</div>
</div>
</div>
<!-- Economics -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">经济</h4>
<label class="flex items-center">
<input class="mr-2" id="economics-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="economics-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合2：化学 &amp; 经济</div>
</div>
</div>
<!-- History -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">历史</h4>
<label class="flex items-center">
<input class="mr-2" id="history-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="history-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合1：物理 &amp; 历史</div>
</div>
</div>
<!-- M2 -->
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-3">
<h4 class="text-lg font-medium text-gray-800">M2</h4>
<label class="flex items-center">
<input class="mr-2" id="m2-evening" type="checkbox"/>
<span class="text-sm text-gray-600">允许晚自习排课</span>
</label>
</div>
<div class="space-y-2">
<div class="flex items-center justify-between">
<span class="text-gray-600">每周课时：</span>
<input class="w-20 px-2 py-1 border border-gray-300 rounded text-center" id="m2-hours" max="10" min="1" type="number" value="5"/>
</div>
<div class="text-xs text-blue-600">选修组合3：生物 &amp; M2</div>
</div>
</div>
</div>
</div>
<!-- Class Structure -->
<div class="mb-6">
<h3 class="text-xl font-semibold mb-4 text-gray-700">分班结构设置</h3>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="border border-gray-200 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-800 mb-3">全年班（4月开学）</h4>
<div class="space-y-2 text-sm">
<div>• 英语：按成绩分A、B班（同时上课）</div>
<div>• 中文、数学：按能力分1、2班（同时上课）</div>
<div>• 选修课：走班制，按组合上课</div>
</div>
</div>
<div class="border border-gray-200 rounded-lg p-4">
<h4 class="text-lg font-medium text-gray-800 mb-3">冲刺班（8月开学）</h4>
<div class="space-y-2 text-sm">
<div>• 所有科目统一授课</div>
<div>• 不分班，集中教学</div>
<div>• 选修课同样按组合安排</div>
</div>
</div>
</div>
</div>
<div class="text-center">
<button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200" onclick="saveCourseSettings()">
<i class="fas fa-save mr-2"></i>保存课程设置
                    </button>
</div>
</div>
</div>
<!-- Teachers Tab -->
<div class="tab-content" id="teachers">
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-2xl font-bold mb-6 text-gray-800">
<i class="fas fa-chalkboard-teacher text-blue-600 mr-2"></i>教师管理
                </h2>
<!-- Add Teacher Form -->
<div class="mb-6 p-4 border border-gray-200 rounded-lg">
<h3 class="text-lg font-semibold mb-4">添加教师</h3>
<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">教师姓名</label>
<input class="w-full px-3 py-2 border border-gray-300 rounded-md" id="teacher-name" placeholder="请输入教师姓名" type="text"/>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">可授课科目</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md" id="teacher-subjects" multiple="">
<option value="chinese">中文</option>
<option value="english-listening-a">英文听力A</option>
<option value="english-listening-b">英文听力B</option>
<option value="english-reading">英文阅读</option>
<option value="english-writing">英文写作</option>
<option value="english-speaking">英文口语</option>
<option value="math">数学</option>
<option value="physics">物理</option>
<option value="chemistry">化学</option>
<option value="biology">生物</option>
<option value="economics">经济</option>
<option value="history">历史</option>
<option value="m2">M2</option>
</select>
</div>
<div class="flex items-end">
<button class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 w-full" onclick="addTeacher()">
<i class="fas fa-plus mr-2"></i>添加教师
                            </button>
</div>
</div>
</div>
<!-- Teachers List -->
<div class="mb-6">
<h3 class="text-lg font-semibold mb-4">教师列表</h3>
<div class="space-y-3" id="teachers-list">
<!-- Teachers will be populated here -->
</div>
</div>
</div>
</div>
<!-- Constraints Tab -->
<div class="tab-content" id="constraints">
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-2xl font-bold mb-6 text-gray-800">
<i class="fas fa-cogs text-blue-600 mr-2"></i>约束条件设置
                </h2>
<!-- Teacher Selection -->
<div class="mb-6">
<label class="block text-lg font-medium text-gray-700 mb-2">选择教师设置约束条件</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md" id="constraint-teacher-select" onchange="loadTeacherConstraints()">
<option value="">请选择教师</option>
</select>
</div>
<!-- Constraints Settings -->
<div class="hidden" id="teacher-constraints-panel">
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
<!-- Available Times -->
<div class="border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3 text-green-700">
<i class="fas fa-check-circle mr-2"></i>可用时间
                            </h3>
<p class="text-sm text-gray-600 mb-3">点击下方时间段设置教师可上课时间</p>
<div class="constraint-time-grid" id="available-times">
<!-- Time slots will be generated here -->
</div>
</div>
<!-- Unavailable Times -->
<div class="border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3 text-red-700">
<i class="fas fa-times-circle mr-2"></i>不可用时间
                            </h3>
<p class="text-sm text-gray-600 mb-3">点击下方时间段设置教师不能上课时间</p>
<div class="constraint-time-grid" id="unavailable-times">
<!-- Time slots will be generated here -->
</div>
</div>
<!-- Preferred Times -->
<div class="border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3 text-blue-700">
<i class="fas fa-star mr-2"></i>优先时间
                            </h3>
<p class="text-sm text-gray-600 mb-3">点击下方时间段设置教师偏好时间</p>
<div class="constraint-time-grid" id="preferred-times">
<!-- Time slots will be generated here -->
</div>
</div>
</div>
<!-- Multi-course Teaching -->
<div class="mt-6 border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3 text-purple-700">
<i class="fas fa-layer-group mr-2"></i>多课程授课设置
                        </h3>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">全年班授课科目</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md h-24" id="full-year-subjects" multiple="">
<!-- Options will be populated based on teacher's subjects -->
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">冲刺班授课科目</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md h-24" id="sprint-subjects" multiple="">
<!-- Options will be populated based on teacher's subjects -->
</select>
</div>
</div>
</div>
<div class="text-center mt-6">
<button class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition duration-200" onclick="saveTeacherConstraints()">
<i class="fas fa-save mr-2"></i>保存约束条件
                        </button>
</div>
</div>
</div>
</div>
<!-- Schedule Tab -->
<div class="tab-content" id="schedule">
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-2xl font-bold mb-6 text-gray-800">
<i class="fas fa-calendar-alt text-blue-600 mr-2"></i>智能排课
                </h2>
<!-- Schedule Settings -->
<div class="mb-6">
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div class="border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3">排课参数设置</h3>
<div class="space-y-3">
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">生成方案数量</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md" id="solution-count">
<option value="3">3个方案</option>
<option selected="" value="5">5个方案</option>
<option value="10">10个方案</option>
</select>
</div>
<div>
<label class="block text-sm font-medium text-gray-700 mb-1">优化目标</label>
<select class="w-full px-3 py-2 border border-gray-300 rounded-md" id="optimization-target">
<option value="teacher-preference">教师偏好时间最大化</option>
<option selected="" value="course-distribution">课程分布均匀化</option>
<option value="balanced">综合平衡</option>
</select>
</div>
</div>
</div>
<div class="border border-gray-200 rounded-lg p-4">
<h3 class="text-lg font-semibold mb-3">晚自习设置</h3>
<div class="space-y-3">
<div class="p-3 bg-yellow-50 rounded">
<div class="text-sm text-yellow-800">
<i class="fas fa-info-circle mr-2"></i>
                                        晚自习排课规则：
                                    </div>
<ul class="text-sm text-yellow-700 mt-2 ml-4">
<li>• 第三节晚自习(20:30-21:30)固定不排课</li>
<li>• 只有标记"允许晚自习排课"的科目可排入</li>
<li>• 前两节晚自习优先自习，必要时安排课程</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<!-- Generate Schedule Button -->
<div class="text-center mb-6">
<button class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition duration-200 text-lg font-semibold" onclick="generateSchedule()">
<i class="fas fa-magic mr-2"></i>开始智能排课
                    </button>
</div>
<!-- Progress -->
<div class="hidden mb-6" id="schedule-progress">
<div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
<div class="flex items-center">
<i class="fas fa-spinner fa-spin text-blue-600 mr-3"></i>
<div>
<div class="text-blue-800 font-medium">正在生成排课方案...</div>
<div class="text-blue-600 text-sm mt-1" id="progress-text">初始化排课引擎</div>
</div>
</div>
<div class="mt-3">
<div class="bg-blue-200 rounded-full h-2">
<div class="bg-blue-600 h-2 rounded-full transition-all duration-300" id="progress-bar" style="width: 0%"></div>
</div>
</div>
</div>
</div>
<!-- Schedule Results -->
<div class="hidden" id="schedule-results">
<div class="border border-gray-200 rounded-lg p-4">
<div class="flex items-center justify-between mb-4">
<h3 class="text-lg font-semibold">生成结果</h3>
<div class="text-sm text-gray-600" id="results-summary"></div>
</div>
<div class="space-y-2" id="solution-list">
<!-- Solutions will be populated here -->
</div>
</div>
</div>
</div>
</div>
<!-- Results Tab -->
<div class="tab-content" id="results">
<div class="bg-white rounded-lg shadow-md p-6">
<h2 class="text-2xl font-bold mb-6 text-gray-800">
<i class="fas fa-table text-blue-600 mr-2"></i>课表展示
                </h2>
<!-- Solution Navigation -->
<div class="flex items-center justify-between mb-6 p-4 bg-gray-50 rounded-lg" id="solution-navigation">
<button class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200" onclick="previousSolution()">
<i class="fas fa-chevron-left mr-2"></i>上一个方案
                    </button>
<div class="text-center">
<div class="text-lg font-semibold" id="current-solution-title">方案 1</div>
<div class="text-sm text-gray-600" id="current-solution-info">点击生成排课方案后查看</div>
</div>
<button class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200" onclick="nextSolution()">
                        下一个方案<i class="fas fa-chevron-right ml-2"></i>
</button>
</div>
<!-- Timetable Display -->
<div id="timetable-container">
<!-- Full Year Classes -->
<div class="mb-8">
<h3 class="text-xl font-semibold mb-4 text-gray-700">全年班课表</h3>
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
<div>
<h4 class="text-lg font-medium mb-2 text-center bg-blue-100 p-2 rounded">英语A班 &amp; 中数1班</h4>
<div class="timetable-grid" id="full-year-a1-timetable"></div>
</div>
<div>
<h4 class="text-lg font-medium mb-2 text-center bg-green-100 p-2 rounded">英语B班 &amp; 中数2班</h4>
<div class="timetable-grid" id="full-year-b2-timetable"></div>
</div>
</div>
</div>
<!-- Sprint Class -->
<div class="mb-8">
<h3 class="text-xl font-semibold mb-4 text-gray-700">冲刺班课表</h3>
<div>
<h4 class="text-lg font-medium mb-2 text-center bg-yellow-100 p-2 rounded">冲刺班</h4>
<div class="timetable-grid" id="sprint-timetable"></div>
</div>
</div>
<!-- Overall Schedule -->
<div class="mb-6">
<h3 class="text-xl font-semibold mb-4 text-gray-700">总课表概览</h3>
<div class="timetable-grid" id="overall-timetable"></div>
</div>
</div>
</div>
</div>
</div>
<script>
        // Global variables
        let teachers = [];
        let courseSettings = {};
        let teacherConstraints = {};
        let solutions = [];
        let currentSolution = 0;

        // Time slots definition
        const timeSlots = [
            { id: 'morning-study', label: '早自习', time: '8:00-8:35' },
            { id: 'period1', label: '第1节', time: '8:35-9:20' },
            { id: 'period2', label: '第2节', time: '9:30-10:15' },
            { id: 'period3', label: '第3节', time: '10:25-11:10' },
            { id: 'period4', label: '第4节', time: '11:20-12:05' },
            { id: 'lunch', label: '午饭时间', time: '12:05-13:35', break: true },
            { id: 'period5', label: '第5节', time: '13:35-14:20' },
            { id: 'period6', label: '第6节', time: '14:30-15:15' },
            { id: 'period7', label: '第7节', time: '15:25-16:10' },
            { id: 'period8', label: '第8节', time: '16:20-17:05' },
            { id: 'dinner', label: '晚饭时间', time: '17:05-18:45', break: true },
            { id: 'evening1', label: '晚自习1', time: '18:45-19:30' },
            { id: 'evening2', label: '晚自习2', time: '19:35-20:20' },
            { id: 'evening3', label: '晚自习3', time: '20:30-21:30', break: true }
        ];

        const weekDays = ['周一', '周二', '周三', '周四', '周五'];

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            document.getElementById(tabName + '-tab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById(tabName + '-tab').classList.add('border-blue-500', 'text-blue-600');
        }

        // Course settings
        function updateEnglishTotal() {
            const listening_a = parseInt(document.getElementById('english-listening-a').value) || 0;
            const listening_b = parseInt(document.getElementById('english-listening-b').value) || 0;
            const reading = parseInt(document.getElementById('english-reading').value) || 0;
            const writing = parseInt(document.getElementById('english-writing').value) || 0;
            const speaking = parseInt(document.getElementById('english-speaking').value) || 0;
            
            const total = listening_a + listening_b + reading + writing + speaking;
            document.getElementById('english-total').textContent = total;
        }

        function saveCourseSettings() {
            courseSettings = {
                chinese: {
                    hours: parseInt(document.getElementById('chinese-hours').value),
                    allowEvening: document.getElementById('chinese-evening').checked
                },
                math: {
                    hours: parseInt(document.getElementById('math-hours').value),
                    allowEvening: document.getElementById('math-evening').checked
                },
                english: {
                    listening_a: parseInt(document.getElementById('english-listening-a').value),
                    listening_b: parseInt(document.getElementById('english-listening-b').value),
                    reading: parseInt(document.getElementById('english-reading').value),
                    writing: parseInt(document.getElementById('english-writing').value),
                    speaking: parseInt(document.getElementById('english-speaking').value),
                    allowEvening: document.getElementById('english-evening').checked
                },
                physics: { 
                    hours: parseInt(document.getElementById('physics-hours').value),
                    allowEvening: document.getElementById('physics-evening').checked
                },
                chemistry: { 
                    hours: parseInt(document.getElementById('chemistry-hours').value),
                    allowEvening: document.getElementById('chemistry-evening').checked
                },
                biology: { 
                    hours: parseInt(document.getElementById('biology-hours').value),
                    allowEvening: document.getElementById('biology-evening').checked
                },
                economics: { 
                    hours: parseInt(document.getElementById('economics-hours').value),
                    allowEvening: document.getElementById('economics-evening').checked
                },
                history: { 
                    hours: parseInt(document.getElementById('history-hours').value),
                    allowEvening: document.getElementById('history-evening').checked
                },
                m2: { 
                    hours: parseInt(document.getElementById('m2-hours').value),
                    allowEvening: document.getElementById('m2-evening').checked
                }
            };
            
            alert('课程设置已保存！');
        }

        // Teacher management
        function addTeacher() {
            const name = document.getElementById('teacher-name').value.trim();
            const subjectSelect = document.getElementById('teacher-subjects');
            const subjects = Array.from(subjectSelect.selectedOptions).map(option => option.value);
            
            if (!name || subjects.length === 0) {
                alert('请填写教师姓名并选择至少一门可授课科目！');
                return;
            }
            
            const teacher = {
                id: Date.now(),
                name: name,
                subjects: subjects
            };
            
            teachers.push(teacher);
            teacherConstraints[teacher.id] = {
                availableTimes: [],
                unavailableTimes: [],
                preferredTimes: [],
                fullYearSubjects: [],
                sprintSubjects: []
            };
            
            document.getElementById('teacher-name').value = '';
            subjectSelect.selectedIndex = -1;
            
            updateTeachersList();
            updateConstraintTeacherSelect();
        }

        function updateTeachersList() {
            const container = document.getElementById('teachers-list');
            container.innerHTML = '';
            
            teachers.forEach(teacher => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 border border-gray-200 rounded-lg';
                div.innerHTML = `
                    <div>
                        <div class="font-medium">${teacher.name}</div>
                        <div class="text-sm text-gray-600">可授课科目: ${teacher.subjects.join(', ')}</div>
                    </div>
                    <button onclick="removeTeacher(${teacher.id})" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        function removeTeacher(teacherId) {
            teachers = teachers.filter(t => t.id !== teacherId);
            delete teacherConstraints[teacherId];
            updateTeachersList();
            updateConstraintTeacherSelect();
        }

        function updateConstraintTeacherSelect() {
            const select = document.getElementById('constraint-teacher-select');
            select.innerHTML = '<option value="">请选择教师</option>';
            
            teachers.forEach(teacher => {
                const option = document.createElement('option');
                option.value = teacher.id;
                option.textContent = teacher.name;
                select.appendChild(option);
            });
        }

        // Constraint management
        function loadTeacherConstraints() {
            const teacherId = document.getElementById('constraint-teacher-select').value;
            const panel = document.getElementById('teacher-constraints-panel');
            
            if (!teacherId) {
                panel.classList.add('hidden');
                return;
            }
            
            panel.classList.remove('hidden');
            
            // Generate time grids
            generateTimeGrid('available-times', 'available');
            generateTimeGrid('unavailable-times', 'unavailable');
            generateTimeGrid('preferred-times', 'preferred');
            
            // Load teacher's subjects for multi-course settings
            const teacher = teachers.find(t => t.id == teacherId);
            if (teacher) {
                updateSubjectSelects(teacher.subjects);
            }
        }

        function generateTimeGrid(containerId, type) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            timeSlots.forEach(slot => {
                if (slot.break) return; // Skip break times
                
                weekDays.forEach(day => {
                    const button = document.createElement('button');
                    button.className = 'time-button';
                    button.textContent = `${day}\n${slot.label}`;
                    button.style.whiteSpace = 'pre-line';
                    button.onclick = () => toggleTimeConstraint(button, type, `${day}-${slot.id}`);
                    container.appendChild(button);
                });
            });
        }

        function toggleTimeConstraint(button, type, timeId) {
            const teacherId = document.getElementById('constraint-teacher-select').value;
            if (!teacherId) return;
            
            const constraints = teacherConstraints[teacherId];
            const timeArray = constraints[type + 'Times'];
            
            button.classList.remove('available', 'unavailable', 'preferred');
            
            if (timeArray.includes(timeId)) {
                // Remove from current type
                const index = timeArray.indexOf(timeId);
                timeArray.splice(index, 1);
            } else {
                // Add to current type and remove from others
                ['available', 'unavailable', 'preferred'].forEach(t => {
                    const arr = constraints[t + 'Times'];
                    const idx = arr.indexOf(timeId);
                    if (idx !== -1) arr.splice(idx, 1);
                });
                timeArray.push(timeId);
                button.classList.add(type);
            }
        }

        function updateSubjectSelects(subjects) {
            const fullYearSelect = document.getElementById('full-year-subjects');
            const sprintSelect = document.getElementById('sprint-subjects');
            
            [fullYearSelect, sprintSelect].forEach(select => {
                select.innerHTML = '';
                subjects.forEach(subject => {
                    const option = document.createElement('option');
                    option.value = subject;
                    option.textContent = getSubjectDisplayName(subject);
                    select.appendChild(option);
                });
            });
        }

        function getSubjectDisplayName(subject) {
            const names = {
                'chinese': '中文',
                'english-listening-a': '英文听力A',
                'english-listening-b': '英文听力B',
                'english-reading': '英文阅读',
                'english-writing': '英文写作',
                'english-speaking': '英文口语',
                'math': '数学',
                'physics': '物理',
                'chemistry': '化学',
                'biology': '生物',
                'economics': '经济',
                'history': '历史',
                'm2': 'M2'
            };
            return names[subject] || subject;
        }

        function saveTeacherConstraints() {
            const teacherId = document.getElementById('constraint-teacher-select').value;
            if (!teacherId) return;
            
            const fullYearSubjects = Array.from(document.getElementById('full-year-subjects').selectedOptions)
                .map(option => option.value);
            const sprintSubjects = Array.from(document.getElementById('sprint-subjects').selectedOptions)
                .map(option => option.value);
            
            teacherConstraints[teacherId].fullYearSubjects = fullYearSubjects;
            teacherConstraints[teacherId].sprintSubjects = sprintSubjects;
            
            alert('约束条件已保存！');
        }

        // Schedule generation
        function generateSchedule() {
            if (teachers.length === 0) {
                alert('请先添加教师信息！');
                return;
            }
            
            if (Object.keys(courseSettings).length === 0) {
                alert('请先设置课程信息！');
                return;
            }
            
            // Show progress
            document.getElementById('schedule-progress').classList.remove('hidden');
            document.getElementById('schedule-results').classList.add('hidden');
            
            // Simulate schedule generation process
            const solutionCount = parseInt(document.getElementById('solution-count').value);
            let progress = 0;
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            const progressSteps = [
                '分析课程约束条件...',
                '检查教师时间约束...',
                '生成初始排课方案...',
                '优化课程分布...',
                '验证方案可行性...',
                '生成多个备选方案...',
                '完成排课生成！'
            ];
            
            let stepIndex = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = progress + '%';
                
                if (stepIndex < progressSteps.length - 1 && progress > (stepIndex + 1) * 14) {
                    stepIndex++;
                }
                progressText.textContent = progressSteps[stepIndex];
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        generateScheduleSolutions(solutionCount);
                        document.getElementById('schedule-progress').classList.add('hidden');
                        document.getElementById('schedule-results').classList.remove('hidden');
                    }, 1000);
                }
            }, 200);
        }

        function generateScheduleSolutions(count) {
            solutions = [];
            
            for (let i = 0; i < count; i++) {
                const solution = {
                    id: i + 1,
                    name: `方案 ${i + 1}`,
                    score: Math.floor(Math.random() * 20) + 80,
                    conflicts: Math.floor(Math.random() * 3),
                    timetable: generateRandomTimetable()
                };
                solutions.push(solution);
            }
            
            // Sort by score
            solutions.sort((a, b) => b.score - a.score);
            
            // Update results display
            const resultsSummary = document.getElementById('results-summary');
            resultsSummary.textContent = `生成了 ${count} 个可行方案，最高分数: ${solutions[0].score}`;
            
            const solutionList = document.getElementById('solution-list');
            solutionList.innerHTML = '';
            
            solutions.forEach((solution, index) => {
                const div = document.createElement('div');
                div.className = `p-3 border rounded-lg cursor-pointer transition-colors ${index === 0 ? 'border-blue-500 bg-blue-50' : 'border-gray-200 hover:bg-gray-50'}`;
                div.onclick = () => selectSolution(index);
                div.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium">${solution.name}</div>
                            <div class="text-sm text-gray-600">评分: ${solution.score} | 冲突: ${solution.conflicts}个</div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                `;
                solutionList.appendChild(div);
            });
            
            // Show first solution
            currentSolution = 0;
            displayCurrentSolution();
        }

        function generateRandomTimetable() {
            const timetable = {
                fullYearA1: {},
                fullYearB2: {},
                sprint: {}
            };
            
            const subjects = ['中文', '数学', '英文阅读', '英文写作', '物理', '化学'];
            const teachers = ['张老师', '李老师', '王老师', '刘老师', '陈老师'];
            
            weekDays.forEach(day => {
                timeSlots.forEach(slot => {
                    if (slot.break) return;
                    
                    const timeKey = `${day}-${slot.id}`;
                    
                    if (Math.random() > 0.3) { // 70% chance of having a class
                        const subject = subjects[Math.floor(Math.random() * subjects.length)];
                        const teacher = teachers[Math.floor(Math.random() * teachers.length)];
                        
                        timetable.fullYearA1[timeKey] = { subject, teacher };
                        timetable.fullYearB2[timeKey] = { subject, teacher: teachers[Math.floor(Math.random() * teachers.length)] };
                        timetable.sprint[timeKey] = { subject, teacher };
                    }
                });
            });
            
            return timetable;
        }

        function selectSolution(index) {
            currentSolution = index;
            displayCurrentSolution();
            
            // Update solution list styling
            document.querySelectorAll('#solution-list > div').forEach((div, i) => {
                if (i === index) {
                    div.className = 'p-3 border rounded-lg cursor-pointer transition-colors border-blue-500 bg-blue-50';
                } else {
                    div.className = 'p-3 border rounded-lg cursor-pointer transition-colors border-gray-200 hover:bg-gray-50';
                }
            });
        }

        function displayCurrentSolution() {
            if (solutions.length === 0) return;
            
            const solution = solutions[currentSolution];
            document.getElementById('current-solution-title').textContent = solution.name;
            document.getElementById('current-solution-info').textContent = `评分: ${solution.score} | 冲突: ${solution.conflicts}个`;
            
            // Generate timetable HTML
            generateTimetableHTML('full-year-a1-timetable', solution.timetable.fullYearA1);
            generateTimetableHTML('full-year-b2-timetable', solution.timetable.fullYearB2);
            generateTimetableHTML('sprint-timetable', solution.timetable.sprint);
            generateOverallTimetable(solution.timetable);
        }

        function generateTimetableHTML(containerId, timetableData) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            let html = '<table class="w-full border-collapse border border-gray-300 text-sm"><thead><tr class="bg-gray-100">';
            html += '<th class="border border-gray-300 p-2">时间</th>';
            weekDays.forEach(day => {
                html += `<th class="border border-gray-300 p-2">${day}</th>`;
            });
            html += '</tr></thead><tbody>';
            
            timeSlots.forEach(slot => {
                html += '<tr>';
                if (slot.break) {
                    html += `<td colspan="6" class="lunch-dinner-break border border-gray-300 p-2 text-center text-gray-500">${slot.label}</td>`;
                } else {
                    html += `<td class="border border-gray-300 p-2 font-medium">${slot.label}<br><span class="text-xs text-gray-500">${slot.time}</span></td>`;
                    weekDays.forEach(day => {
                        const timeKey = `${day}-${slot.id}`;
                        const classInfo = timetableData[timeKey];
                        
                        if (classInfo) {
                            const colorClass = getSubjectColorClass(classInfo.subject);
                            html += `<td class="border border-gray-300 p-2 ${colorClass}">${classInfo.subject}<br><span class="text-xs">${classInfo.teacher}</span></td>`;
                        } else {
                            html += '<td class="border border-gray-300 p-2 text-center text-gray-400">-</td>';
                        }
                    });
                }
                html += '</tr>';
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function generateOverallTimetable(timetableData) {
            const container = document.getElementById('overall-timetable');
            if (!container) return;
            
            let html = '<table class="w-full border-collapse border border-gray-300 text-xs"><thead><tr class="bg-gray-100">';
            html += '<th class="border border-gray-300 p-2">时间</th>';
            html += '<th class="border border-gray-300 p-2">全年A1班</th>';
            html += '<th class="border border-gray-300 p-2">全年B2班</th>';
            html += '<th class="border border-gray-300 p-2">冲刺班</th>';
            html += '</tr></thead><tbody>';
            
            weekDays.forEach(day => {
                timeSlots.forEach(slot => {
                    html += '<tr>';
                    if (slot.break) {
                        html += `<td colspan="4" class="lunch-dinner-break border border-gray-300 p-1 text-center text-gray-500">${day} ${slot.label}</td>`;
                    } else {
                        html += `<td class="border border-gray-300 p-1 font-medium">${day}<br>${slot.label}</td>`;
                        
                        ['fullYearA1', 'fullYearB2', 'sprint'].forEach(classType => {
                            const timeKey = `${day}-${slot.id}`;
                            const classInfo = timetableData[classType][timeKey];
                            
                            if (classInfo) {
                                const colorClass = getSubjectColorClass(classInfo.subject);
                                html += `<td class="border border-gray-300 p-1 ${colorClass}">${classInfo.subject}<br>${classInfo.teacher}</td>`;
                            } else {
                                html += '<td class="border border-gray-300 p-1 text-center text-gray-400">-</td>';
                            }
                        });
                    }
                    html += '</tr>';
                });
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function getSubjectColorClass(subject) {
            const colorMap = {
                '中文': 'subject-color-chinese',
                '英文阅读': 'subject-color-english',
                '英文写作': 'subject-color-english',
                '英文听力A': 'subject-color-english',
                '英文听力B': 'subject-color-english',
                '英文口语': 'subject-color-english',
                '数学': 'subject-color-math',
                '物理': 'subject-color-physics',
                '化学': 'subject-color-chemistry',
                '生物': 'subject-color-biology',
                '经济': 'subject-color-economics',
                '历史': 'subject-color-history',
                'M2': 'subject-color-m2'
            };
            return colorMap[subject] || '';
        }

        function previousSolution() {
            if (solutions.length === 0) return;
            currentSolution = (currentSolution - 1 + solutions.length) % solutions.length;
            displayCurrentSolution();
        }

        function nextSolution() {
            if (solutions.length === 0) return;
            currentSolution = (currentSolution + 1) % solutions.length;
            displayCurrentSolution();
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for English course hours
            ['english-listening-a', 'english-listening-b', 'english-reading', 'english-writing', 'english-speaking'].forEach(id => {
                document.getElementById(id).addEventListener('input', updateEnglishTotal);
            });
            
            // Initialize English total
            updateEnglishTotal();
            
            // Add sample data for demonstration
            setTimeout(() => {
                // Add sample teachers
                teachers.push(
                    { id: 1, name: 'Stella老师', subjects: ['english-listening-a', 'english-listening-b', 'english-reading'] },
                    { id: 2, name: '张老师', subjects: ['chinese'] },
                    { id: 3, name: '李老师', subjects: ['math'] },
                    { id: 4, name: '王老师', subjects: ['physics', 'chemistry'] }
                );
                
                teachers.forEach(teacher => {
                    teacherConstraints[teacher.id] = {
                        availableTimes: [],
                        unavailableTimes: [],
                        preferredTimes: [],
                        fullYearSubjects: teacher.subjects,
                        sprintSubjects: teacher.subjects
                    };
                });
                
                updateTeachersList();
                updateConstraintTeacherSelect();
            }, 500);
        });
    </script>
</body>
</html>
